@echo off
:: XyloMouseTweaks.cmd  –  pure CMD, no PowerShell
:: Run as Administrator or it will exit.
net session >nul 2>&1 || (
   echo This script must be run as Administrator.
   pause & exit /b 1
)

setlocal enabledelayedexpansion
set "RPName=XyloMouseTweaks_Backup"

:menu
cls
echo ✨ Xylo Services – Free Mouse Tweaks ✨
echo.
echo 0  Create Restore Point only
echo 1  Faster menus ^(MouseHoverTime=8 ms^)
echo 2  1000 Hz USB polling
echo 3  Disable mouse acceleration
echo 4  Prevent USB selective suspend
echo A  Apply ALL selected above
echo U  Undo ^(restore last Restore Point^)
echo X  Exit
echo.
set /p "choice=Choose (comma/space ok, e.g. 1,3,A): "
if /i "%choice%"=="X" exit /b

:: ---------- create restore point ----------
echo.
echo Creating restore point ...
wmic shadowcopy call create Volume=%SystemDrive%\ >nul 2>&1
if %errorlevel%==0 (
   echo Restore point created.
) else (
   echo WMIC failed, continuing anyway ...
)

:: ---------- parse choices ----------
set "t1=0"
set "t2=0"
set "t3=0"
set "t4=0"
for %%c in (%choice%) do (
   if /i "%%c"=="1" set t1=1
   if /i "%%c"=="2" set t2=1
   if /i "%%c"=="3" set t3=1
   if /i "%%c"=="4" set t4=1
   if /i "%%c"=="A" set t1=1&set t2=1&set t3=1&set t4=1
   if /i "%%c"=="U" goto undo
)

:: ---------- apply selected ----------
if %t1%==1 (
   echo Applying faster menus ...
   reg add "HKCU\Control Panel\Mouse" /v MouseHoverTime /t REG_SZ /d 8 /f >nul
)
if %t2%==1 (
   echo Applying 1000 Hz USB polling ...
   reg add "HKLM\SYSTEM\CurrentControlSet\Services\HIDUSB\Parameters" /v MaxPollInterval /t REG_DWORD /d 1 /f >nul
)
if %t3%==1 (
   echo Disabling mouse acceleration ...
   reg add "HKCU\Control Panel\Mouse" /v MouseSpeed /t REG_SZ /d 0 /f >nul
   reg add "HKCU\Control Panel\Mouse" /v MouseThreshold1 /t REG_SZ /d 0 /f >nul
   reg add "HKCU\Control Panel\Mouse" /v MouseThreshold2 /t REG_SZ /d 0 /f >nul
)
if %t4%==1 (
   echo Preventing USB selective suspend ...
   reg add "HKLM\SYSTEM\CurrentControlSet\Enum\USB\ROOT_HUB\30&PID\Parameters" /v SelectiveSuspendEnabled /t REG_DWORD /d 0 /f >nul 2>&1
)

echo.
echo ✅ Selected tweaks applied – reboot recommended.
pause
exit /b

:undo
echo.
echo Rolling back via restore point ...
rstrui.exe /offline:%RPName% >nul 2>&1
echo Done.  Reboot to see changes reverted.
pause
exit /byy
